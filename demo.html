<!DOCTYPE html>
<html lang="es" class="h-full bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Demo Interactivo (Plataforma Moderna)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFxOqyhIAjwy7ckIZPNkqCza-PuWfNQBo&v=weekly&libraries=marker" async defer></script>

    <style>
        /* CR√çTICO: Vistas ocultas por defecto y solo una visible */
        .view {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .view.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 100%;
            height: 100%;
        }
        
        /* Clase activa para el Sidebar */
        .nav-tab.active {
            background-color: #eff6ff; /* bg-blue-50 */
            color: #1d48d8; /* text-blue-700 */
            font-weight: 600;
        }

        /* Estilo para el prospect card seleccionado */
        .prospect-card.selected {
            background-color: #eff6ff; /* bg-blue-50 */
            border-left-color: #2563eb; /* border-blue-600 */
            transform: translateX(4px);
        }

        /* Transiciones para Modals y Panels */
        .transition-all {
            transition: all 0.3s ease-in-out;
        }
        .translate-x-full {
            transform: translateX(100%);
        }
        .translate-x-0 {
            transform: translateX(0);
        }
        .opacity-0 {
            opacity: 0;
        }
        .opacity-100 {
            opacity: 1;
        }
        .pointer-events-none {
            pointer-events: none;
        }
        .pointer-events-auto {
            pointer-events: auto;
        }
    </style>
</head>
<body class="h-full">

    <div class="sticky top-0 z-50 bg-gradient-to-r from-yellow-500 to-red-600 text-white text-center p-3 text-sm font-bold shadow-lg">
        <strong>Importante:</strong> Esto es solo un <strong>ejemplo</strong> de nuestra plataforma (configurada para Roofing).
        Tu CRM ser√° 100% personalizado a tu industria. 
        <a href="https://contrasac85-svg.github.io/crmdemo/" target="_blank" class="font-bold underline hover:text-yellow-200">Volver para cotizar</a>
    </div>

    <div id="app-shell" class="flex h-[calc(100vh-44px)]"> <nav class="flex w-64 flex-col bg-white shadow-2xl z-20">
            
            <div class="flex h-20 flex-shrink-0 items-center justify-center px-4 shadow-md">
                <span class="text-2xl font-bold text-blue-600">üíº Demo CRM</span>
            </div>

            <div class="flex-1 overflow-y-auto p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" onclick="switchView('dashboard', this)"
                           class="nav-tab group active flex items-center rounded-lg px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600">
                            <i data-feather="home" class="mr-3 h-5 w-5"></i>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showModal('documentsModal'); setActive(this);"
                           class="nav-tab group flex items-center rounded-lg px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600">
                            <i data-feather="file-text" class="mr-3 h-5 w-5"></i>
                            Generar Contrato
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showModal('appointmentsModal'); setActive(this);"
                           class="nav-tab group flex items-center rounded-lg px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600">
                            <i data-feather="calendar" class="mr-3 h-5 w-5"></i>
                            Citas
                        </a>
                    </li>
                </ul>
            </div>

            <div class="border-t border-gray-200 p-4">
                <ul class="space-y-2">
                     <li>
                        <a href="#" onclick="togglePhonePanel(); setActive(this);"
                           class="nav-tab group flex items-center rounded-lg px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600">
                            <i data-feather="phone" class="mr-3 h-5 w-5"></i>
                            Tel√©fono
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showModal('emailModal'); setActive(this);"
                           class="nav-tab group flex items-center rounded-lg px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600">
                            <i data-feather="mail" class="mr-3 h-5 w-5"></i>
                            Email R√°pido
                        </a>
                    </li>
                     <li>
                        <a href="#" onclick="showModal('adminModal'); setActive(this);"
                           class="nav-tab group flex items-center rounded-lg px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600">
                            <i data-feather="settings" class="mr-3 h-5 w-5"></i>
                            Admin
                        </a>
                    </li>
                </ul>
            </div>

            <div class="border-t border-gray-200 p-4">
                <div class="mb-3">
                    <div class="text-sm font-medium text-gray-900" id="currentUser">Usuario Demo</div>
                    <div class="text-xs text-gray-500" id="userRole">Administrador</div>
                </div>
                <button onclick="alert('Demo: Cerrando sesi√≥n... ¬°Gracias por probar!')"
                    class="flex w-full items-center justify-center rounded-lg bg-red-50 px-4 py-3 text-sm font-medium text-red-700 hover:bg-red-100">
                    <i data-feather="log-out" class="mr-3 h-5 w-5"></i>
                    Cerrar Sesi√≥n
                </button>
            </div>
        </nav>

        <main class= "flex flex-1 flex-col overflow bg-gray-100">
            
            <header class="flex h-20 flex-shrink-0 items-center justify-between bg-white px-6 shadow-md z-10">
                <div id="clientInfo" class="flex items-center space-x-4">
                     <div>
                        <span class="text-sm font-medium text-gray-900">Cliente: </span>
                        <span id="clientName" class="text-sm text-gray-600">No seleccionado</span>
                     </div>
                     <div class="flex items-center">
                        <span id="dbStatus" class="status-indicator online mr-2 h-2 w-2 rounded-full"></span>
                        <span class="text-sm text-gray-600">Base: <span id="dbInfo" class="font-medium text-blue-600">DEMO</span></span>
                     </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div id="telnyxStatus" classF="flex items-center space-x-2 rounded-full bg-green-100 py-2 px-4">
                        <div id="telnyxIndicator" class="h-2 w-2 rounded-full bg-green-500 animate-pulse"></div>
                        <span class="text-sm font-medium text-green-800">VoIP: <span id="telnyxStatusText">Conectado</span></span>
                    </div>
                    <button onclick="alert('Demo: Datos actualizados!')" class="rounded-full p-2 text-gray-600 hover:bg-gray-100 hover:text-blue-600" title="Actualizar Datos">
                        <i data-feather="refresh-cw" class="h-5 w-5"></i>
                    </button>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-6 relative">
                
                <div class="absolute top-6 right-6 z-30">
                    <div class="cursor-pointer rounded-lg bg-gradient-to-r from-purple-600 to-indigo-700 px-5 py-3 text-white shadow-xl transition-all hover:scale-105" onclick="showModal('contactModal')">
                        <div class="text-sm font-bold">üéÆ MODO DEMO</div>
                        <div class="text-xs opacity-90">Click para cotizar</div>
                    </div>
                </div>

                <div id="dashboard" class="view active">
                    <div class="flex h-full flex-col gap-6 lg:flex-row">
                        
                        <div class="flex h-full w-full flex-col rounded-xl bg-white shadow-lg lg:w-1/3">
                            <div class="flex-shrink-0 rounded-t-xl bg-blue-600 p-4 text-white">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg font-semibold">Prospectos (5)</h3>
                                    <button class="rounded-lg bg-white/20 px-3 py-1 text-sm font-medium transition-all hover:bg-white/30" onclick="alert('Demo: Creando nuevo prospecto...')">
                                        + Nuevo
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4 space-y-3" id="prospectsList">
                                </div>
                        </div>

                        <div class="h-[500px] w-full rounded-xl bg-white shadow-lg lg:h-full lg:w-2/3 overflow-hidden">
                            <div id="map" class="h-full w-full"></div>
                        </div>

                    </div>
                </div>
                
                <div id="documents" class="view"></div>
                <div id="appointments" class="view"></div>

            </div>
        </main>
    </div>

    <div id="modal-overlay" onclick="closeAllModals()" class="fixed inset-0 z-40 bg-black/60 backdrop-blur-sm transition-all opacity-0 pointer-events-none"></div>

    <div id="phonePanel" class="fixed top-0 right-0 z-50 h-full w-80 bg-white shadow-2xl transition-all translate-x-full">
        <div class="flex h-full flex-col">
            <div class="flex items-center justify-between border-b border-gray-200 p-4">
                <h3 class="text-lg font-semibold text-blue-600">üìû M√≥dulo de Comunicaciones</h3>
                <button onclick="togglePhonePanel()" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="h-6 w-6"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-4">
                <div class="rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 p-4 text-white shadow-lg">
                    <strong class="block text-lg">Telefon√≠a VoIP y M√°s</strong>
                    <p class="mt-1 text-sm opacity-90">
                        Integra VoIP, SMS, Email y WhatsApp. Todas las interacciones se registran autom√°ticamente en el perfil del cliente.
                    </p>
                </div>

                <div class="my-4 rounded-lg bg-gray-100 p-4 text-center text-3xl font-semibold text-gray-800" id="phoneDisplay">
                    _
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <button class="keypad-btn" onclick="dialNumber('1')">1</button>
                    <button class="keypad-btn" onclick="dialNumber('2')">2</button>
                    <button class="keypad-btn" onclick="dialNumber('3')">3</button>
                    <button class="keypad-btn" onclick="dialNumber('4')">4</button>
                    <button class="keypad-btn" onclick="dialNumber('5')">5</button>
                    <button class="keypad-btn" onclick="dialNumber('6')">6</button>
                    <button class="keypad-btn" onclick="dialNumber('7')">7</button>
                    <button class="keypad-btn" onclick="dialNumber('8')">8</button>
                    <button class="keypad-btn" onclick="dialNumber('9')">9</button>
                    <button class="keypad-btn" onclick="dialNumber('*')">*</button>
                    <button class="keypad-btn" onclick="dialNumber('0')">0</button>
                    <button class="keypad-btn" onclick="dialNumber('#')">#</button>
                </div>

                <button class="mt-4 w-full rounded-lg bg-green-500 py-3 text-lg font-bold text-white transition-all hover:bg-green-600" onclick="makeCall()">
                    <i data-feather="phone-call" class="inline-block h-5 w-5 mr-2"></i>
                    Llamar
                </button>
            </div>
        </div>
    </div>
    
    <div id="documentsModal" class="modal fixed top-1/2 left-1/2 z-50 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-white shadow-2xl transition-all opacity-0 pointer-events-none">
        <div class="p-6">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-blue-600">üìÑ Gesti√≥n Documental Avanzada</h3>
                <button onclick="closeModal('documentsModal')" class="text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
            </div>
            <p class="mt-4 text-gray-600">
                Este m√≥dulo te permite generar contratos profesionales (3rd Party, ACV, RCV, etc.) con un solo clic, poblados con la informaci√≥n del cliente.
            </p>
            <div class="mt-4 rounded-lg border border-green-200 bg-green-50 p-4">
                <strong class="text-green-800">üîí Certificaci√≥n Criptogr√°fica</strong>
                <p class="text-sm text-green-700">
                    Todos los documentos generados incluyen firmas digitales y un **hash criptogr√°fico SHA-256** para garantizar su validez e inmutabilidad.
                </p>
            </div>
            <button class="mt-6 w-full rounded-lg bg-blue-600 py-2.5 font-medium text-white hover:bg-blue-700" onclick="closeModal('documentsModal')">
                Entendido
            </button>
        </div>
    </div>

    <div id="appointmentsModal" class="modal fixed top-1/2 left-1/2 z-50 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-white shadow-2xl transition-all opacity-0 pointer-events-none">
        <div class="p-6">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-blue-600">üìÖ M√≥dulo de Citas y Calendario</h3>
                <button onclick="closeModal('appointmentsModal')" class="text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
            </div>
            <p class="mt-4 text-gray-600">
                Gestiona tu calendario, agenda citas y asigna inspectores o equipos de trabajo.
            </p>
            <ul class="mt-4 space-y-2 text-gray-700">
                <li class="flex items-center"><i data-feather="check-circle" class="mr-2 h-5 w-5 text-green-500"></i> Sincronizaci√≥n con Google Calendar.</li>
                <li class="flex items-center"><i data-feather="check-circle" class="mr-2 h-5 w-5 text-green-500"></i> Recordatorios autom√°ticos por SMS/Email.</li>
                <li class="flex items-center"><i data-feather="check-circle" class="mr-2 h-5 w-5 text-green-500"></i> Asignaci√≥n por zonas y disponibilidad.</li>
            </ul>
            <button class="mt-6 w-full rounded-lg bg-blue-600 py-2.5 font-medium text-white hover:bg-blue-700" onclick="closeModal('appointmentsModal')">
                Entendido
            </button>
        </div>
    </div>

    <div id="emailModal" class="modal fixed top-1/2 left-1/2 z-50 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-white shadow-2xl transition-all opacity-0 pointer-events-none">
        <div class="p-6">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-blue-600">‚úâÔ∏è M√≥dulo de Email R√°pido</h3>
                <button onclick="closeModal('emailModal')" class="text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
            </div>
            <p class="mt-4 text-gray-600">
                Env√≠a correos electr√≥nicos a tus clientes directamente desde el CRM sin tener que abrir tu bandeja de entrada.
            </p>
            <div class="mt-4 rounded-lg border border-gray-200 bg-gray-50 p-4">
                <strong class="text-gray-800">Bandeja de Salida Simulada</strong>
                <div class="mt-2 space-y-2">
                    <div class="rounded border bg-white p-2 text-sm"><strong>Para:</strong> john.smith@example.com<br><strong>Asunto:</strong> Seguimiento de tu inspecci√≥n</div>
                    <div class="rounded border bg-white p-2 text-sm"><strong>Para:</strong> jane.doe@example.com<br><strong>Asunto:</strong> Tu contrato de roofing</div>
                </div>
                <p class="mt-2 text-xs text-gray-500">En la app real, esto se conecta a tu proveedor (Gmail, SendGrid, etc.) para env√≠os y tracking.</p>
            </div>
            <button class="mt-6 w-full rounded-lg bg-blue-600 py-2.5 font-medium text-white hover:bg-blue-700" onclick="closeModal('emailModal')">
                Entendido
            </button>
        </div>
    </div>

    <div id="adminModal" class="modal fixed top-1/2 left-1/2 z-50 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-white shadow-2xl transition-all opacity-0 pointer-events-none">
        <div class="p-6">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-blue-600">‚öôÔ∏è Panel de Administraci√≥n</h3>
                <button onclick="closeModal('adminModal')" class="text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
            </div>
            <p class="mt-4 text-gray-600">
                Aqu√≠ es donde gestionas todos los aspectos de tu plataforma:
            </p>
            <ul class="mt-4 space-y-2 text-gray-700">
                <li class="flex items-start"><i data-feather="users" class="mr-2 h-5 w-5 flex-shrink-0 text-blue-500"></i> <strong>Gesti√≥n de Usuarios:</strong> Crea y administra cuentas para telefonistas, gestores, administradores y personal de campo.</li>
                <li class="flex items-start"><i data-feather="dollar-sign" class="mr-2 h-5 w-5 flex-shrink-0 text-green-500"></i> <strong>Sistema de Comisiones:</strong> Configura las reglas para el pago autom√°tico de comisiones.</li>
                <li class="flex items-start"><i data-feather="database" class="mr-2 h-5 w-5 flex-shrink-0 text-purple-500"></i> <strong>Gesti√≥n de Bases de Datos:</strong> Administra tus diferentes bases de datos (clientes, prospectos, etc.).</li>
            </ul>
            <button class="mt-6 w-full rounded-lg bg-blue-600 py-2.5 font-medium text-white hover:bg-blue-700" onclick="closeModal('adminModal')">
                Entendido
            </button>
        </div>
    </div>

    <div id="prospectModal" class="modal fixed top-1/2 left-1/2 z-50 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-white shadow-2xl transition-all opacity-0 pointer-events-none">
        <div class="p-6">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-blue-600" id="prospectModalName">Nombre del Prospecto</h3>
                <button onclick="closeModal('prospectModal')" class="text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
            </div>
            <div class="mt-4">
                <p class="text-lg text-gray-700" id="prospectModalAddress"></p>
                <p class="text-lg text-gray-500" id="prospectModalPhone"></p>
                <div class="mt-4">
                    <span class="font-medium">Estado:</span>
                    <span class="inline-block rounded-full px-3 py-1 text-sm font-semibold" id="prospectModalStatus"></span>
                </div>
                <div class="mt-6 rounded-lg bg-gray-50 p-4">
                    <h4 class="font-semibold text-gray-800">Acciones de Demo</h4>
                    <p class="text-sm text-gray-600">En la app real, aqu√≠ ver√≠as el historial de llamadas, emails, documentos firmados y notas. Podr√≠as:</p>
                    <div class="mt-3 flex flex-wrap gap-2">
                        <button class="btn-demo-action"><i data-feather="phone-call" class="h-4 w-4 mr-1"></i> Iniciar Llamada</button>
                        <button class="btn-demo-action"><i data-feather="mail" class="h-4 w-4 mr-1"></i> Enviar Email</button>
                        <button class="btn-demo-action"><i data-feather="file-text" class="h-4 w-4 mr-1"></i> Generar Contrato</button>
                        <button class="btn-demo-action"><i data-feather="calendar" class="h-4 w-4 mr-1"></i> Agendar Cita</button>
                    </div>
                </div>
            </div>
            <button class="mt-6 w-full rounded-lg bg-blue-600 py-2.5 font-medium text-white hover:bg-blue-700" onclick="closeModal('prospectModal')">
                Cerrar
            </button>
        </div>
    </div>
    
    <div id="contactModal" class="modal fixed top-1/2 left-1/2 z-50 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-white shadow-2xl transition-all opacity-0 pointer-events-none">
        <div class="p-6">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-blue-600">üìû Cotiza tu Proyecto</h3>
                <button onclick="closeModal('contactModal')" class="text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
            </div>
            <p class="mt-2 text-lg text-gray-600">¬øListo para una plataforma 100% personalizada?</p>
            
            <div class="my-4 rounded-lg bg-gray-50 p-4">
                <h4 class="font-semibold text-gray-800">Informaci√≥n de Contacto</h4>
                <p class="mt-1 text-gray-700"><strong>üìû Tel√©fono:</strong> 442-378-8891</p>
                <p class="mt-1 text-gray-700"><strong>‚úâÔ∏è Email:</strong> contras.a.c.85@gmail.com</p>
            </div>

            <div class="text-center">
                <p class="text-4xl font-bold text-blue-700">$3,199 <span class="text-lg font-medium text-gray-600">MXN/mes</span></p>
                <p class="text-sm text-gray-500">Plan mensual ‚Ä¢ Desarrollo y m√≥dulos base incluidos</p>
            </div>

            <button class="mt-6 w-full rounded-lg bg-green-500 py-3 font-bold text-white transition-all hover:bg-green-600" onclick="alert('¬°Gracias por tu inter√©s! Cont√°ctanos al 442-378-8891')">
                Solicitar Cotizaci√≥n Ahora
            </button>
        </div>
    </div>

    <style>
        .keypad-btn {
            @apply rounded-lg bg-gray-200 py-3 text-xl font-semibold text-gray-800 transition-all hover:bg-gray-300 active:scale-95;
        }
        .btn-demo-action {
            @apply flex items-center rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-700 transition-all hover:bg-blue-200;
        }
    </style>
    
    <script>
        // ========== DEMO DATA ==========
        const demoProspects = [
            { id: 1, name: "John Smith", address: "123 Main St, Springdale", phone: "(479) 555-0101", status: "contacted", lat: 36.1867, lng: -94.1288, statusColor: "bg-blue-100 text-blue-800", borderColor: "border-blue-500" },
            { id: 2, name: "Jane Doe", address: "456 Oak Ave, Fayetteville", phone: "(479) 555-0102", status: "converted", lat: 36.0822, lng: -94.1719, statusColor: "bg-green-100 text-green-800", borderColor: "border-green-500" },
            { id: 3, name: "Robert Johnson", address: "789 Pine Rd, Rogers", phone: "(479) 555-0103", status: "assigned", lat: 36.3321, lng: -94.1185, statusColor: "bg-purple-100 text-purple-800", borderColor: "border-purple-500" },
            { id: 4, name: "Mary Williams", address: "321 Elm St, Bentonville", phone: "(479) 555-0104", status: "prospect", lat: 36.3729, lng: -94.2088, statusColor: "bg-yellow-100 text-yellow-800", borderColor: "border-yellow-500" },
            { id: 5, name: "James Brown", address: "654 Maple Dr, Lowell", phone: "(479) 555-0105", status: "new_lead", lat: 36.2550, lng: -94.1302, statusColor: "bg-pink-100 text-pink-800", borderColor: "border-pink-500" }
        ];

        let map;
        let phoneNumber = '';

        // ========== INITIALIZATION ==========
        window.addEventListener('DOMContentLoaded', () => {
            loadProspects();
            initMap();
            feather.replace(); // Inicializa iconos
            console.log('üéÆ Demo CRM Moderno cargado');
        });

        // ========== VIEW SWITCHING ==========
        function switchView(viewName, element) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewName).classList.add('active');
            setActive(element);
        }

        function setActive(element) {
            if (element) {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                element.classList.add('active');
            }
        }

        // ========== PROSPECTS ==========
        function loadProspects() {
            const container = document.getElementById('prospectsList');
            container.innerHTML = demoProspects.map(p => `
                <div id="prospect-${p.id}" class="prospect-card cursor-pointer rounded-lg border-l-4 p-4 shadow-sm transition-all hover:bg-gray-50 hover:shadow-md ${p.borderColor}" 
                     onclick="selectProspect(${p.id})">
                    <div class="flex items-center justify-between">
                        <div class="text-base font-semibold text-gray-800">${p.name}</div>
                        <span class="rounded-full px-2.5 py-0.5 text-xs font-medium ${p.statusColor}">
                            ${p.status.replace('_', ' ')}
                        </span>
                    </div>
                    <div class="mt-1 text-sm text-gray-500">${p.address}</div>
                </div>
            `).join('');
        }

        function selectProspect(id) {
            const prospect = demoProspects.find(p => p.id === id);
            if (!prospect) return;

            // Pan map
            if (map) {
                map.setCenter({ lat: prospect.lat, lng: prospect.lng });
                map.setZoom(15);
            }
            
            // Highlight card
            document.querySelectorAll('.prospect-card').forEach(card => card.classList.remove('selected'));
            document.getElementById(`prospect-${id}`).classList.add('selected');
            
            // Update header
            document.getElementById('clientName').textContent = prospect.name;

            // Show Prospect Info Modal
            document.getElementById('prospectModalName').textContent = prospect.name;
            document.getElementById('prospectModalAddress').textContent = prospect.address;
            document.getElementById('prospectModalPhone').textContent = prospect.phone;
            
            const statusEl = document.getElementById('prospectModalStatus');
            statusEl.textContent = prospect.status.replace('_', ' ');
            statusEl.className = `inline-block rounded-full px-3 py-1 text-sm font-semibold ${prospect.statusColor}`;
            
            showModal('prospectModal');
        }

        // ========== MAP ==========
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: { lat: 36.1867, lng: -94.1288 },
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: true
            });

            // Add markers
            demoProspects.forEach(p => {
                const statusColors = {
                    new_lead: '#ec4899',
                    prospect: '#f59e0b',
                    contacted: '#3b82f6',
                    assigned: '#8b5cf6',
                    converted: '#10b981'
                };

                new google.maps.Marker({
                    position: { lat: p.lat, lng: p.lng },
                    map: map,
                    title: p.name,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 8,
                        fillColor: statusColors[p.status] || '#666',
                        fillOpacity: 1,
                        strokeColor: '#fff',
                        strokeWeight: 2
                    }
                });
            });
        }

        // ========== PHONE PANEL ==========
        function togglePhonePanel() {
            const panel = document.getElementById('phonePanel');
            panel.classList.toggle('translate-x-full');
        }

        function dialNumber(num) {
            phoneNumber += num;
            document.getElementById('phoneDisplay').textContent = phoneNumber || '_';
        }

        function makeCall() {
            if (phoneNumber.length > 0) {
                alert(`üìû Llamada demo iniciada a: ${phoneNumber}\n\n‚úÖ En la plataforma real, esto conecta v√≠a VoIP y registra la llamada.`);
                phoneNumber = '';
                document.getElementById('phoneDisplay').textContent = '_';
                togglePhonePanel(); // Cierra el panel despu√©s de llamar
            } else {
                alert('Por favor ingresa un n√∫mero');
            }
        }

        // ========== MODALS ==========
        const overlay = document.getElementById('modal-overlay');

        function showModal(modalId) {
            closeAllModals(); // Cierra otros modales primero
            const modal = document.getElementById(modalId);
            if (modal) {
                overlay.classList.remove('opacity-0', 'pointer-events-none');
                overlay.classList.add('opacity-100', 'pointer-events-auto');
                
                modal.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-100', 'pointer-events-auto');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                overlay.classList.add('opacity-0', 'pointer-events-none');
                overlay.classList.remove('opacity-100', 'pointer-events-auto');

                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-100', 'pointer-events-auto');
            }
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                closeModal(modal.id);
            });
        }
    </script>
</body>
</html>
